<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.induk.cinema.repository.SeatRepository">
<resultMap id="resultSeat" type="com.induk.cinema.domain.Seat">
    <id property="id" column="id"/>
    <result property="theater_id" column="theater_id"/>
    <result property="number" column="number"/>
    <result property="status" column="status"/>
    <result property="reservation_id" column="reservation_id"/>
    <association property="seatTheater" javaType="com.induk.cinema.dto.SeatTheater">
        <result property="theaterName" column="theaterName"/>
    </association>
</resultMap>

    <select id="findAll" resultMap="resultSeat">
        select seat.*, theater.name as theaterName from seat left join theater on seat.theater_id = theater.id
    </select>

    <select id="findTheater" resultType="com.induk.cinema.domain.Theater">
        select * from theater
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="com.induk.cinema.domain.Seat">
        insert into seat(theater_id, number, status, reservation_id)
        values (#{theater_id}, #{number}, #{status}, #{reservation_id})
    </insert>

    <select id="findById" parameterType="Long" resultMap="resultSeat">
        select seat.*, theater.name as theaterName from seat left join theater on seat.theater_id = theater.id where seat.id = #{id}
    </select>

    <select id="findByTheaterId" parameterType="Long" resultType="String">
        select name from theater where id = #{id}
    </select>

    <update id="update" parameterType="Seat">
        update seat
        set theater_id=#{theater_id}, number=#{number}, status=#{status}, reservation_id=#{reservation_id}
        where id=#{id}
    </update>

    <delete id="delete" parameterType="Long">
        delete from seat where id = #{id}
    </delete>
</mapper>
