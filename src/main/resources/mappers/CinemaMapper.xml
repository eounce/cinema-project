<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.induk.cinema.repository.CinemaRepository">
<resultMap id="resultCinema" type="com.induk.cinema.domain.Cinema">
    <id property="id" column="id"/>
    <result property="city_id" column="city_id"/>
    <result property="name" column="name"/>
    <result property="subtitle" column="subtitle"/>
    <result property="facility" column="facility"/>
    <result property="introduction" column="introduction"/>
    <result property="parking" column="parking"/>
    <result property="address" column="address"/>
    <result property="mapAddress" column="mapAddress"/>
    <result property="sales" column="sales"/>
    <association property="cinemaCity" javaType="com.induk.cinema.dto.CinemaCity">
        <result property="cityName" column="cityName"/>
    </association>
</resultMap>

<resultMap id="resultScedule" type="com.induk.cinema.domain.Schedule">
    <id property="id" column="id"/>
    <result property="movie_id" column="movie_id"/>
    <result property="theather_id" column="theather_id"/>
    <result property="start_time" column="start_time"/>
    <result property="end_time" column="end_time"/>
    <result property="screening_data" column="screening_data"/>
    <result property="screening_format" column="screening_format"/>
    <result property="price" column="price"/>
    <association property="scheduleForm" javaType="com.induk.cinema.dto.ScheduleForm">
        <result property="movie_title" column="movie_title"/>
        <result property="movie_rating" column="movie_rating"/>
        <result property="movie_showtimes" column="movie_showtimes"/>
        <result property="theater_name" column="theater_name"/>
        <result property="theater_seat" column="theater_seat"/>
        <result property="cinema_id" column="cinema_id"/>
    </association>
</resultMap>

    <select id="findAll" resultMap="resultCinema">
        select cinema.*, city.name as cityName
        from cinema left join city on cinema.city_id = city.id
    </select>

    <select id="findCity" resultType="com.induk.cinema.domain.City">
        select * from city
    </select>

    <select id="findSceduleByCinema" resultMap="resultScedule">
        select schedule.*, movie.title as movie_title, movie.rating as movie_rating, movie.show_times as movie_showtimes, theater.name as theater_name, theater.seat_count as theater_seat, theater.cinema_id as cinema_id from schedule left join movie on schedule.movie_id = movie.id
        left join theater on schedule.theater_id = theater.id where theater.cinema_id = #{id}
    </select>

    <select id="findById" parameterType="Long" resultMap="resultCinema">
        select cinema.*, city.name as cityName
        from cinema left join city on cinema.city_id = city.id where cinema.id = #{id}
    </select>

    <select id="findMovie" parameterType="Long" resultMap="resultScedule">
        select distinct movie.title as movie_title, movie.screening_format as screening_format, movie.rating as movie_rating, movie.show_times as movie_showtimes, theater.name as theater_name, theater.seat_count as theater_seat, theater.cinema_id as cinema_id from schedule left join movie on schedule.movie_id = movie.id
        left join theater on schedule.theater_id = theater.id where theater.cinema_id = #{id}
    </select>

    <select id="findCinemaListByCityId" parameterType="Long" resultMap="resultCinema">
        select cinema.*, city.name as cityName
        from cinema left join city on cinema.city_id = city.id where cinema.city_id = #{id}
    </select>

    <select id="findByCityId" parameterType="Long" resultType="String">
        select name from city where id = #{id}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="Cinema">
        insert into cinema(city_id, name, subtitle, facility, introduction, parking, address, mapAddress, sales)
        values (#{city_id}, #{name}, #{subtitle}, #{facility}, #{introduction}, #{parking}, #{address}, #{mapAddress}, #{sales})
    </insert>

    <update id="update" parameterType="Cinema">
        update cinema
        set city_id=#{city_id}, name=#{name}, subtitle=#{subtitle}, facility=#{facility}, introduction=#{introduction}, parking=#{parking}, address=#{address}, mapAddress=#{mapAddress}, sales=#{sales}
        where id=#{id}
    </update>

    <delete id="delete" parameterType="Long">
        delete from cinema where id = #{id}
    </delete>
</mapper>
