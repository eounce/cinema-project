<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.induk.cinema.repository.CinemaRepository">
<resultMap id="resultCinema" type="com.induk.cinema.domain.Cinema">
    <id property="id" column="id"/>
    <result property="dong_id" column="dong_id"/>
    <result property="name" column="name"/>
    <result property="introduction" column="introduction"/>
    <result property="address" column="address"/>
    <result property="mapAddress" column="mapAddress"/>
    <result property="sales" column="sales"/>
    <association property="cinemaCity" javaType="com.induk.cinema.dto.CinemaCity">
        <result property="cityName" column="cityName"/>
        <result property="dongName" column="dongName"/>
    </association>
</resultMap>

    <select id="findAll" resultMap="resultCinema">
        select cinema.*, dong.name as dongName, city.name as cityName
        from (cinema left join dong on cinema.dong_id = dong.id) left join city on dong.city_id = city.id
    </select>

    <select id="findCity" resultType="com.induk.cinema.domain.City">
        select * from city
    </select>

    <select id="findById" parameterType="Long" resultMap="resultCinema">
        select cinema.*, dong.name as dongName, city.name as cityName
        from (cinema left join dong on cinema.dong_id = dong.id) left join city on dong.city_id = city.id where cinema.id = #{id}
    </select>

    <select id="findByCityId" parameterType="Long" resultType="String">
        select name from city where id = #{id}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="Cinema">
        insert into cinema(dong_id, name, introduction, address, mapAddress, sales)
        values (#{dong_id}, #{name}, #{introduction}, #{address}, #{mapAddress}, #{sales})
    </insert>

    <update id="update" parameterType="Cinema">
        update cinema
        set dong_id=#{dong_id}, name=#{name}, introduction=#{introduction}, address=#{address}, mapAddress=#{mapAddress}, sales=#{sales}
        where id=#{id}
    </update>

    <delete id="delete" parameterType="Long">
        delete from cinema where id = #{id}
    </delete>
</mapper>
